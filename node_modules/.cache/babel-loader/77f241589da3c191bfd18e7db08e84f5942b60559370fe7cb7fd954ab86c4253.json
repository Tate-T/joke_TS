{"ast":null,"code":"import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport axios from 'axios';\nexport const requestJokes = createAsyncThunk('jokes/get', async (_, thunkApi) => {\n  const {\n    data\n  } = await axios.get('https://official-joke-api.appspot.com/jokes/ten');\n  return data;\n});\nexport const requestRefreshJokes = createAsyncThunk('jokes/refresh', async (_, thunkApi) => {\n  const {\n    data\n  } = await axios.get('https://official-joke-api.appspot.com/jokes/ten');\n  const jokes = thunkApi.getState().jokes.jokes;\n  const jokesIds = jokes.map(joke => joke.id); //['1' ,'2', '3'] -> {id: '3', ...}\n  const hasDublicates = !data.every(newJoke => !jokesIds.includes(newJoke.id));\n  if (hasDublicates) {\n    thunkApi.dispatch(requestRefreshJokes());\n    return thunkApi.rejectWithValue(false);\n  }\n  return data;\n});\nconst initialState = {\n  jokes: [],\n  favJokes: [],\n  isLoading: false\n};\nconst jokesSlice = createSlice({\n  name: 'jokes',\n  initialState,\n  reducers: {\n    addJoke: (state, _ref) => {\n      let {\n        payload\n      } = _ref;\n      state.favJokes = [...state.favJokes, payload];\n    },\n    deleteJoke: (state, _ref2) => {\n      let {\n        payload\n      } = _ref2;\n      state.favJokes = state.favJokes.filter(joke => joke.id !== payload.id);\n    }\n  },\n  extraReducers: builder => builder.addCase(requestJokes.pending, state => {\n    state.isLoading = true;\n  }).addCase(requestJokes.fulfilled, (state, action) => {\n    state.isLoading = false;\n    state.jokes = action.payload;\n  }).addCase(requestRefreshJokes.fulfilled, (state, action) => {\n    state.isLoading = false;\n    state.jokes = [...state.jokes, ...action.payload];\n  })\n});\nexport const {\n  addJoke,\n  deleteJoke\n} = jokesSlice.actions;\nexport default jokesSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","axios","requestJokes","_","thunkApi","data","get","requestRefreshJokes","jokes","getState","jokesIds","map","joke","id","hasDublicates","every","newJoke","includes","dispatch","rejectWithValue","initialState","favJokes","isLoading","jokesSlice","name","reducers","addJoke","state","_ref","payload","deleteJoke","_ref2","filter","extraReducers","builder","addCase","pending","fulfilled","action","actions","reducer"],"sources":["/Users/tetiana.tarasovych/Desktop/jokes_type-script/src/redux/jokesReducer.ts"],"sourcesContent":["import {\n  createAsyncThunk,\n  createSlice,\n  PayloadAction,\n} from '@reduxjs/toolkit';\nimport axios from 'axios';\nimport { RootState } from './store';\n\nexport type Joke = {\n  id: number\n  type: string\n  setup: string\n  punchline: string\n};\n\ntype JokesState = {\n  favJokes: Joke[]\n  jokes: Joke[]\n  isLoading: boolean\n};\n\nexport const requestJokes = createAsyncThunk(\n  'jokes/get',\n  async (_, thunkApi) => {\n    const { data } = await axios.get<Joke[]>(\n      'https://official-joke-api.appspot.com/jokes/ten',\n    )\n    return data\n  },\n);\n\nexport const requestRefreshJokes = createAsyncThunk(\n  'jokes/refresh',\n  async (_, thunkApi) => {\n    const { data } = await axios.get<Joke[]>(\n      'https://official-joke-api.appspot.com/jokes/ten',\n    )\n    const jokes = (thunkApi.getState() as RootState).jokes.jokes as Joke[]\n    const jokesIds = jokes.map((joke) => joke.id) //['1' ,'2', '3'] -> {id: '3', ...}\n    const hasDublicates = !data.every(\n      (newJoke: Joke) => !jokesIds.includes(newJoke.id),\n    )\n\n    if (hasDublicates) {\n      thunkApi.dispatch(requestRefreshJokes())\n      return thunkApi.rejectWithValue(false)\n    }\n\n    return data\n  },\n);\n\nconst initialState: JokesState = {\n  jokes: [],\n  favJokes: [],\n  isLoading: false,\n};\n\nconst jokesSlice = createSlice({\n  name: 'jokes',\n  initialState,\n  reducers: {\n    addJoke: (state, { payload }: PayloadAction<Joke>) => {\n      state.favJokes = [...state.favJokes, payload]\n    },\n    deleteJoke: (state, { payload }: PayloadAction<Joke>) => {\n      state.favJokes = state.favJokes.filter((joke) => joke.id !== payload.id)\n    },\n  },\n  extraReducers: (builder) =>\n    builder\n      .addCase(requestJokes.pending, (state) => {\n        state.isLoading = true\n      })\n      .addCase(\n        requestJokes.fulfilled,\n        (state, action: PayloadAction<Joke[]>) => {\n          state.isLoading = false\n          state.jokes = action.payload\n        },\n      )\n      .addCase(\n        requestRefreshJokes.fulfilled,\n        (state, action: PayloadAction<Joke[]>) => {\n          state.isLoading = false\n          state.jokes = [...state.jokes, ...action.payload]\n        },\n      ),\n});\n\nexport const { addJoke, deleteJoke } = jokesSlice.actions;\nexport default jokesSlice.reducer;\n"],"mappings":"AAAA,SACEA,gBAAgB,EAChBC,WAAW,QAEN,kBAAkB;AACzB,OAAOC,KAAK,MAAM,OAAO;AAgBzB,OAAO,MAAMC,YAAY,GAAGH,gBAAgB,CAC1C,WAAW,EACX,OAAOI,CAAC,EAAEC,QAAQ,KAAK;EACrB,MAAM;IAAEC;EAAK,CAAC,GAAG,MAAMJ,KAAK,CAACK,GAAG,CAC9B,iDAAiD,CAClD;EACD,OAAOD,IAAI;AACb,CAAC,CACF;AAED,OAAO,MAAME,mBAAmB,GAAGR,gBAAgB,CACjD,eAAe,EACf,OAAOI,CAAC,EAAEC,QAAQ,KAAK;EACrB,MAAM;IAAEC;EAAK,CAAC,GAAG,MAAMJ,KAAK,CAACK,GAAG,CAC9B,iDAAiD,CAClD;EACD,MAAME,KAAK,GAAIJ,QAAQ,CAACK,QAAQ,EAAE,CAAeD,KAAK,CAACA,KAAe;EACtE,MAAME,QAAQ,GAAGF,KAAK,CAACG,GAAG,CAAEC,IAAI,IAAKA,IAAI,CAACC,EAAE,CAAC,EAAC;EAC9C,MAAMC,aAAa,GAAG,CAACT,IAAI,CAACU,KAAK,CAC9BC,OAAa,IAAK,CAACN,QAAQ,CAACO,QAAQ,CAACD,OAAO,CAACH,EAAE,CAAC,CAClD;EAED,IAAIC,aAAa,EAAE;IACjBV,QAAQ,CAACc,QAAQ,CAACX,mBAAmB,EAAE,CAAC;IACxC,OAAOH,QAAQ,CAACe,eAAe,CAAC,KAAK,CAAC;EACxC;EAEA,OAAOd,IAAI;AACb,CAAC,CACF;AAED,MAAMe,YAAwB,GAAG;EAC/BZ,KAAK,EAAE,EAAE;EACTa,QAAQ,EAAE,EAAE;EACZC,SAAS,EAAE;AACb,CAAC;AAED,MAAMC,UAAU,GAAGvB,WAAW,CAAC;EAC7BwB,IAAI,EAAE,OAAO;EACbJ,YAAY;EACZK,QAAQ,EAAE;IACRC,OAAO,EAAEA,CAACC,KAAK,EAAAC,IAAA,KAAuC;MAAA,IAArC;QAAEC;MAA6B,CAAC,GAAAD,IAAA;MAC/CD,KAAK,CAACN,QAAQ,GAAG,CAAC,GAAGM,KAAK,CAACN,QAAQ,EAAEQ,OAAO,CAAC;IAC/C,CAAC;IACDC,UAAU,EAAEA,CAACH,KAAK,EAAAI,KAAA,KAAuC;MAAA,IAArC;QAAEF;MAA6B,CAAC,GAAAE,KAAA;MAClDJ,KAAK,CAACN,QAAQ,GAAGM,KAAK,CAACN,QAAQ,CAACW,MAAM,CAAEpB,IAAI,IAAKA,IAAI,CAACC,EAAE,KAAKgB,OAAO,CAAChB,EAAE,CAAC;IAC1E;EACF,CAAC;EACDoB,aAAa,EAAGC,OAAO,IACrBA,OAAO,CACJC,OAAO,CAACjC,YAAY,CAACkC,OAAO,EAAGT,KAAK,IAAK;IACxCA,KAAK,CAACL,SAAS,GAAG,IAAI;EACxB,CAAC,CAAC,CACDa,OAAO,CACNjC,YAAY,CAACmC,SAAS,EACtB,CAACV,KAAK,EAAEW,MAA6B,KAAK;IACxCX,KAAK,CAACL,SAAS,GAAG,KAAK;IACvBK,KAAK,CAACnB,KAAK,GAAG8B,MAAM,CAACT,OAAO;EAC9B,CAAC,CACF,CACAM,OAAO,CACN5B,mBAAmB,CAAC8B,SAAS,EAC7B,CAACV,KAAK,EAAEW,MAA6B,KAAK;IACxCX,KAAK,CAACL,SAAS,GAAG,KAAK;IACvBK,KAAK,CAACnB,KAAK,GAAG,CAAC,GAAGmB,KAAK,CAACnB,KAAK,EAAE,GAAG8B,MAAM,CAACT,OAAO,CAAC;EACnD,CAAC;AAET,CAAC,CAAC;AAEF,OAAO,MAAM;EAAEH,OAAO;EAAEI;AAAW,CAAC,GAAGP,UAAU,CAACgB,OAAO;AACzD,eAAehB,UAAU,CAACiB,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}